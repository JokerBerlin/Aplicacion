

<!-- Usuario: Erick sulca
	 fecha: 01/06/18
	 última modificación: 12/06/18
	 Descripción: se agrego la función getMapa, y toggleBounce para hacer más dinámico el marcador del mapa -->

{% extends "base.html" %}

{% block imports %}
<script >

$(document).ready(function(){
		$('#id_nombre').focus();
});

var marker, infoWindow;
var mapa;

var	initMap = function() {
	mapa = new google.maps.Map(document.getElementById('map'), {
		center: {lat: -13.1587800, lng: -74.2232100},
		zoom: 17
	});

	infoWindow = new google.maps.InfoWindow;

	if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var pos = {
        lat: position.coords.latitude,
        lng: position.coords.longitude
      };

      var config = {
        position: pos
      };

      marker = new google.maps.Marker({
          position: config.position,
		  map: mapa,
		  animation: google.maps.Animation.DROP,
          draggable: true
      })
	  mapa.setCenter(pos);
	  
	document.getElementById('id_latitud').value = marker.getPosition().lat();
	document.getElementById('id_longitud').value = marker.getPosition().lng();
	marker.addListener('click', toggleBounce);
	marker.addListener('dragend', function(event){
		document.getElementById("id_latitud").value=this.getPosition().lat();
		document.getElementById("id_longitud").value=this.getPosition().lng();
	});


    }, function() {
      handleLocationError(true, infoWindow, mapa.getCenter());
    });
	} else {
		// Browser doesn't support Geolocation
		handleLocationError(false, infoWindow, mapa.getCenter());
	}
}

function handleLocationError(browserHasGeolocation, infoWindow, pos) {
  infoWindow.setPosition(pos);
  infoWindow.setContent(browserHasGeolocation ?
                        'Error: TEl servicio de geolocalizacion no funciono.' :
                        'Error: Tu navegador no posee servicio de geolocalizacion, utiliza Google Chrome en su lugar.');
  infoWindow.open(mapa);
}

console.log(marker);

function toggleBounce(){

	if(marker.getAnimation() !== null){
		marker.setAnimation(null);
	}else{
		marker.setAnimation(google.maps.Animation.BOUNCE);
	}
}

</script>
{% endblock %}

{% block title %}
Registrar Nuevo Cliente
{% endblock %}

{% block content %}
	<div class="row">
  	<div class="col-sm-12">
    	<div class="white-box">
      	<h3 class="box-title">Formulario de nuevo cliente</h3>
        	<form action="." method="post" enctype="multipart/form-data">
						{% csrf_token %}
						<ul>
							<div class="col-lg-12" style="margin-top:2px;">
								<div class="col-xs-4 col-sm-4 col-md-4">
									<label for="id_nombre">Nombre:</label><br>
									<input type="text" name="nombre" id="id_nombre" required="" class="form-control" maxlength="45">
								</div>
								<div class="col-xs-4 col-sm-4 col-md-4">
									<label for="id_direccion">Direccion:</label>
									<input type="text" name="direccion" id="id_direccion" required="" class="form-control" maxlength="45">
								</div>
								<div class="col-xs-4 col-sm-4 col-md-4">
									<label for="id_numerodocumento">Numero documento:</label><br>
									<input type="number" name="numerodocumento" id="id_numerodocumento" class="form-control" maxlength="11">
								</div>
							</div>

							<div class="col-lg-12" style="margin-top:2px;">
								<div class="col-xs-4 col-sm-4 col-md-4">
									<label for="id_precio">Tipo de cliente:</label><br>
									<select class="form-control" id="cmbPrecio" name="id_precio" required="">
										{% for precio in precios %}
											<option value="{{precio.id}}">
											{{precio.nombre}}
											</option>
										{% endfor %}
									</select>
								</div>
								<div class="col-xs-4 col-sm-4 col-md-4">
									<label for="id_latitud">Latitud:</label><br>
									<input type="text" name="latitud" id="id_latitud" class="form-control" maxlength="50" readonly="readonly">
									<br>
								</div>
								<div class="col-xs-4 col-sm-4 col-md-4">
									<label for="id_longitud">Longitud:</label><br>
									<input type="text" name="longitud" id="id_longitud" class="form-control" maxlength="50" readonly="readonly">
								</div>
							</div>
						</ul>
						<ul>
   <!--
				{% load widget_tweaks %}
				{% csrf_token %}
					<div class="form-group">
				    {% for field in form %}
							{{ field.errors }}
							{{ field.label_tag }}</br>
							{{ field|add_class:"form-control" }}
				    {% endfor %}
-->
							<br>
							<label for="id_latitud">My Google Maps Demo</label><br>

										<div id="map" style="position: relative;overflow: hidden;height: 300px;">
									    <script async defer
									    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA94LBsliF6TX_7XT76lfJAopVP_h2RkkU&callback=initMap">
						    			</script>

					   			 	</div>
					   		<br>
							<button type="submit" class="btn btn-success">Agregar Cliente</button>
						</ul>
				</form>
	    	</div>
	    </div>
    </div>
{% endblock %}
