{% extends "base.html" %}
{% block imports %}
<script type="text/javascript" src="/static/js/crearPedido.js"></script>
<link href="/static/css/styleAutocomplete.css" rel="stylesheet">
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>


<script type="text/javascript">

//filtro de clientes por dni o numero documento ajax

$(document).ready(function(){
  $( "#inpt-cliente" ).focus();
  $( "#inpt-cliente" ).autocomplete({
      source: function (request, response) {

          var datos = {nombreCliente: $("#inpt-cliente").val()};
          var sendData = JSON.stringify(datos);
          $.ajax({
              type: "POST",
              dataType: "json",
              url: "/cliente/buscar/",
              data: sendData,
              contentType: "application/json; charset=utf-8",
              async: false,
              cache: false,
              CrossDomain: true,

              success: function (result) {
              var ListasClientes = result['clientes'];
              response($.map(ListasClientes, function (item) {
                  return {label: item.numerodocumento,
                        nombreC: item.nombre};
                console.log(item.nombre);
              }));

              }
          });
      },
      minLength: 1,
      select: function (event, ui) {
          console.log(ui.item.nombreC );
          $("#nombreCl").val(ui.item.nombreC);
          $('#inpt-producto').focus();
      }

  });
});


    $(document).ready(function(){
        //$('cantidad').prop('disabled', true);
        $( "#inpt-producto" ).click(function(){
          //alert(document.getElementById("presentacion"));
          if (document.getElementById("presentacion").length!=0 ) {
            var pre = document.getElementById("presentacion");
            pre.options.length = 0;
            var valorRemove = document.getElementById("valor");
            valorRemove.options.length = 0;
          }
          $('#presentacion').prop('disabled', 'disabled');
          $('#cantidad').prop('disabled', 'disabled');
          //$('#codigo').val('');
          //$('#precio').val('');
        });
        $( "#inpt-producto" ).autocomplete({
            source: function (request, response) {

                var datos = {nombreProducto: $("#inpt-producto").val()};
                var sendData = JSON.stringify(datos);
                $.ajax({
                    type: "POST",
                    dataType: "json",
                    url: "/productopre/buscar/",
                    data: sendData,
                    contentType: "application/json; charset=utf-8",
                    async: false,
                    cache: false,
                    CrossDomain: true,

                    success: function (result) {
                      if (document.getElementById("presentacion").length!=0 ) {
                        var pre = document.getElementById("presentacion");
                        pre.options.length = 0;
                        var valorRemove = document.getElementById("valor");
                        valorRemove.options.length = 0;
                      }
                      var ListasProductos = result['productos'];
                      var ListarPresentaciones = result['presentacion'];

                      response($.map(ListasProductos, function (item) {
                          return {
                              label: item.nombre,
                              idproducto: item.nombre,
                              precio: item.valor,
                              codigo: item.codigo,
                              Id: item.id,
                              };
                          })
                        );
                          //$('#presentacion');
                          var sel = document.getElementById("presentacion");
                          var sel2 = document.getElementById("valor");
                          for (var i in ListarPresentaciones) {
                              var option = document.createElement("option");
                              option.value = ListarPresentaciones[i].id;
                              option.text = ListarPresentaciones[i].nombre;
                              sel.add(option);
                              var option2 = document.createElement("option");
                              option2.value = ListarPresentaciones[i].id;
                              option2.text = ListarPresentaciones[i].valor;
                              sel2.add(option2);

                      }

                      var valor1= $("#valor option:selected").html();
                      var valor2= $("#valor").val();

                      $( "#codigo" ).val( valor2);
                      $( "#precio" ).val( valor1);



                      }





                  });
            },
            minLength: 2,
            select: function (event, ui) {
                $.data(document.body, 'idproducto', ui.item.Id);//guardar el id en memoria el $.data guarda en memoria
                $('#presentacion').removeAttr('disabled');
                $('#cantidad').removeAttr('disabled');
                $('#presentacion').focus();
            }


        });
  });


  $('select[name="seleccionar"]').on('change', function() {
  $('select[name="valor"]').val(this.value);
});

$(document).ready(function() {
  $('#presentacion').change(function(event) {
      var cambiarSelect = $('#presentacion').val();
      var valor = $('#valor').val(cambiarSelect);
      $('#valor').change();
      var valorTexto= $("#valor option:selected").html();
      var valorId= $("#valor").val();

      $( "#codigo" ).val( valorId);
      $( "#precio" ).val( valorTexto);
  });
});





</script>

{% endblock %}


{% block title %}
Nuevo Pedido
{% endblock %}

{% block content %}

<p id="demo"></p>

    <div class="row">
        <div class="col-sm-12">
            <div class="white-box">
                <h3 class="box-title">Nuevo Pedido</h3>
                <!--<form method="post" enctype="multipart/form-data">
                  {% csrf_token %}-->


                <label for="id_nombre">Cliente:</label>
                <br>
                <div class="col-lg-12" style="margin-top:2px;">
                  <div class="col-xs-6 col-sm-6 col-md-6">
                    <input type="text" id="inpt-cliente" placeholder="Nr. Documento cliente..." name="cliente_buscado" class="form-control">
                  </div>
                  <div class="col-xs-6 col-sm-6 col-md-6">
                        <input type="text" id="nombreCl" name="nombreCl" class="form-control" disabled="disabled">
                  </div>
                </div>
                <label for="id_nombre">Producto:</label>
                <br>
                <input type="text" name="inpt-producto" id="inpt-producto" required="" class="form-control" maxlength="45">
                <br>
                <label for="">Codigo presentacion:</label>
                <select id="presentacion" class="form-control" name="seleccionar" disabled="disabled" >
                </select>
                <select style="display:none" id="valor" class="form-control" name="valor">
                </select>
                <br>
                <label for="id_nombre">Código:</label>
                <input type="text" name="codigo" id="codigo" required="" class="form-control" disabled="disabled">
                <br>
                <label for="id_nombre">Precio:</label>
                <br>
                <input type="number" name="precio" id="precio" required="" class="form-control" disabled="disabled">
                <br>
                <label for="id_nombre">Cantidad:</label>
                <br>
                <input type="number" name="cantidad" id="cantidad" required="" class="form-control" disabled="disabled" >
                <br>
                <button id="bt_add" class="btn btn-success">Agregar</button>
                <button id="bt_del" class="btn btn-warning">Eliminar</button>
                <button id="bt_delall" class="btn btn-danger">Eliminar todo</button>

                    <div class="row">
                        <div class="form-group">
                            <label ><center>Concepto Operación</center></label>
                            <table id="tabla" name="tablacontenido" class="table table-bordered">
                            <thead>
                                <tr>
                                    <td>Nº</td>
                                    <td>Cantidad</td>
                                    <td>Cod. Producto</td>
                                    <td>Nombre</td>
                                    <td>Precio Unit.</td>
                                    <td>Total</td>
                                </tr>
                            </thead>


                            </table>

                            <br>
                        </div>
                            TOTAL: S/. <label for="id_Total" id="id_Total" name="id_Total"></label>
                            <br>
                            <br>

                        <button id="bt_GenerarVenta" class="btn btn-success">Generar Venta</button>
                      <!--</form>-->
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <div class="col-sm-8 col-md-8 col-lg-6">
                                <div id="tabs" style="display:none;">
                                    <table id="listaProducto"></table>
                                    <div id="pagerlistaProducto"  style="text-align: center;"></div>
                                </div>
                            </div>

                            <div class="col-sm-2 col-md-2 col-lg-4">

                            </div>
                        </div>
                    </div>


    </div>
  </div>
</div>

{% endblock %}
