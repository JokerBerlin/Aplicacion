{% extends "base.html" %}

{% block imports %}


{% endblock %}

{% block title %}
Editar pedido
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-sm-12">
            <div class="white-box">
                <h3 class="box-title">Editar Pedido</h3>

                  <label class="control-label col-sm-3" for="inputSuccess3">Numero de pedido:
                        </label>
                        <input class="form-control" type="text" id="pedido_id" value="{{ pedidoId }}" disabled>

                   <label class="control-label col-sm-3" for="inputSuccess3">Nombre cliente:
                           </label>
                    <input class="form-control" type="text" name="" value="{{ cliente }}" disabled>
                    <br>
                    <label class="control-label col-sm-3" for="inputSuccess3">Fecha pedido:
                            </label>
                     <input class="form-control" type="text" name="" value="{{ fecha }}"disabled>
                     <br>
                    <label class="control-label col-sm-3" for="inputSuccess3">Nombre empleado:
                    </label>
                    <input class="form-control" type="text" name="" value="{{ empleado }}" disabled>
                    <br>
                    <div class="col-lg-12" style="margin-top:2px;">
                      <div class="col-xs-12 col-sm-12 col-md-12">

                        <div class="row">
                            <div class="form-group">
                                <label ><center>Concepto Operación</center></label>
                                <table id="tabla" name="tablacontenido" class="table table-bordered">
                                <thead>
                                    <tr>
                                      <td>Nº</td>
                                      <td>Cantidad</td>
                                      <td>Cod. Producto</td>
                                      <td>Nombre</td>
                                      <td>Presentacion</td>
                                      <td>Precio Unit.</td>
                                      <td>Total</td>
                                    </tr>
                                </thead>
                                <tbody>
                                  {% for pedido in pedidos  %}
                                    {% for cant in cantidadPedido %}
                                      {% if pedido.id == cant.id %}
                                      <tr>
                                        <td>{{pedido.id}}</td>
                                        <td><input type="text" class="form-control" id="cantidad{{cant.contador}}" value="{{ cant.cantidad }}">
                                      </td>
                                        <td>{{pedido.productopresentacions.producto.codigo}}</td>
                                        <td>{{pedido.productopresentacions.producto.nombre}}</td>
                                        <td>{{pedido.productopresentacions.presentacion.nombre}}</td>
                                        <td>{{cant.valor}}</td>
                                        <td>{{ cant.total }}</td>

                                      </tr>
                                      {% endif %}

                                    {% endfor %}

                                  {% endfor %}
                                </tbody>

                                </table>
                                <script type="text/javascript">
                                  $(document).ready(function() {
                                    $("#generarAlmacen").click(function() {
                                      var num=1;
                                      productos = [];
                                      contador = 0;
                                      $('#tabla tbody tr').each(function (index) {
                                        // productosPedido = [];
                                        // var id = $(this).find("td").eq(0).html();
                                        // var cantidad = $(this).find("td").eq(1).html();
                                        // console.log(codigo);
                                        $(this).children("td").each(function (index2) {
                                            producto = [];
                                            //dato = index;
                                            console.log(index);
                                            switch (index2) {
                                                case 0:
                                                    id = $(this).text();
                                                case 1:
                                                    cantidad = $("#cantidad"+index ).val();
                                                    break;
                                            }

                                        });
                                        contador = 1;
                                        productos.push([id,cantidad]);
                                        });
                                        console.log(productos);
                                        if (contador == 1) {
                                            var pedido = document.getElementById("pedido_id").value;
                                            console.log(pedido);
                                            var datos = {productos: productos,pedido:pedido};
                                            var sendData = JSON.stringify(datos);
                                            $.ajax({
                                                type: "POST",
                                                dataType: "json",
                                                url: "/Pedido/modificar/",
                                                data: sendData,
                                                contentType: "application/json; charset=utf-8",
                                                async: false,
                                                cache: false,
                                                CrossDomain: true,

                                                success: function (result) {
                                                //     var id_venta = result["id_venta"];
                                                     alert('Pedido modificado');
                                                     //location.reload(true);
                                                     document.location.href='/Pedido/listar/';
                                                }
                                            });
                                        }else{
                                            alert("No registró ningún producto");
                                        }
                                    });
                                  });
                                </script>
                                <br>
                            </div>
                                TOTAL: S/. <label for="id_Total" id="id_Total" name="id_Total"></label>
                                <br>
                                <br>

                            <button id="generarAlmacen" >Generar Venta</button>
                          <!--</form>-->
                        </div>
                      </div>
                    </div>
                    <div class="row">
                        <div class="form-group">
                            <div class="col-sm-8 col-md-8 col-lg-6">
                                <div id="tabs" style="display:none;">
                                    <table id="listaProducto"></table>
                                    <div id="pagerlistaProducto"  style="text-align: center;"></div>
                                </div>
                            </div>

                            <div class="col-sm-2 col-md-2 col-lg-4">

                            </div>
                        </div>
                    </div>

            </div>
        </div>
    </div>

{% endblock %}
