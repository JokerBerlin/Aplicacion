{% extends "base.html" %}
{% block imports %}
    <script type="text/javascript" src="/static/js/producto.js"></script>
{% endblock %}

{% block title %}
Registrar Nuevo Producto
{% endblock %}

{% block content %}
	<div class="row">
        <div class="col-sm-12">
            <div class="white-box">
                <h3 class="box-title">Formulario de registro de Producto</h3>
                <button class="btn btn-success" data-toggle="modal" data-target="#agrearPresentacion">Agregar Presentacion</button>
                <button class="btn btn-primary" id="listaProducto">Listar productos</button>


<div class="modal fade" id="agrearPresentacion" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	Tabla de contenidos
			      <div class="modal-dialog">
			        <div class="modal-content">
			          <div class="modal-header">
			            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			            <h4>Agregar Presentacion</h4>
			          </div>
			          <div class="modal-body">
			          Producto:</br>
					    <input type="text" name="idProducto" id="productoId" required class="form-control" value="{{producto.nombre}}">
			            Presentación</br>
			            <form action="/Presentacion/registrar/" method="post" enctype="multipart/form-data">
						{% csrf_token %}
					    <select class="form-control" id="cmbPresentacion" required>
					    	<!--<option value=""> </option>-->
	                        {% for presentacion in presentaciones %}
	                            <option value="{{presentacion.id}}">
	                            {{presentacion.nombre}}
	                            </option>
	                        {% endfor %}
	                        </select>
	                    Valor de Presentación</br>
					    <input type="number" name="cantPresentacion" id="cantPresentacion" required class="form-control">
					    {% for precio in precios%}
						Precio - {{ precio.nombre }}</br>
					    <input type="number" name="{{precio.id}}Precio" id="{{precio.id}}Precio" required class="form-control">
					    {% endfor %}</br>
			          </div>
                <div class="modal-footer">
                  <button id="registrarPresentacion" type="button" class="btn btn-primary" onclick="">Registrar</button>
                  <button type="button" class="btn btn-secondary" id="productoListar" data-dismiss="modal">Listar Productos</button>
                  <script type="text/javascript">
                    $(document).ready(function(){
                      $('#registrarPresentacion').click(function(){
                        presentaciones = []
                        precios = []
                        var producto = document.getElementById("productoId").value;
                        var presentacion = document.getElementById("cmbPresentacion").value;
                        var valor = document.getElementById("cantPresentacion").value;
                        var precio1 = document.getElementById("1Precio").value;
                        var precio2 = document.getElementById("2Precio").value;
                        var precio3 = document.getElementById("3Precio").value;
                        presentaciones.push([producto,presentacion,valor]);
                        precios.push([precio1,precio2,precio3]);
                        var datos = {
                              presentaciones: presentaciones,
                              precios: precios
                          };

                          var sendData = JSON.stringify(datos);
                          $.ajax({
                              type: "POST",
                              dataType: "json",
                              url: "/Presentacion/nuevo/",
                              data: sendData,
                              contentType: "application/json; charset=utf-8",
                              async: false,
                              cache: false,
                              CrossDomain: true,

                              success: function (result) {
                              //     var id_venta = result["id_venta"];
                                  var sel = document.getElementById("cmbPresentacion");
                                  sel.remove(sel.SelectedIndex);
                                  $(' #cantPresentacion ').val("");
                                  $(' #1Precio ').val("");
                                  $(' #2Precio ').val("");
                                  $(' #3Precio ').val("");
                                  alert('Presentacion de producto Registrado');
                                   //location.reload(true);
                                   //document.location.href='/Pedido/listar/';
                              }
                          });

                      });
                      $('#productoListar').click(function(){
                        document.location.href='/Producto/listar/';
                      });
                      $('#listaProducto').click(function(){
                        document.location.href='/Producto/listar/';
                      });
                    });
                  </script>
                </div>
			</div>
	    </div>
    </div>
{% endblock %}
