{% extends "base.html" %}
{% block imports %}
    <script type="text/javascript" src="/static/js/producto.js"></script>
    <script type="text/javascript" src="/static/js/crearPresentacion.js"></script>
    <link href="/static/css/styleAutocomplete.css" rel="stylesheet">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>


{% endblock %}

{% block title %}
Registrar Nuevo Producto
{% endblock %}

{% block content %}
	<div class="row">
      <div class="col-sm-12">
          <div class="white-box">
              <h3 class="box-title">Formulario de registro de Producto</h3>
              <button class="btn btn-success" data-toggle="modal" data-target="#agrearPresentacion">Agregar Presentacion</button>
              <button class="btn btn-primary" id="listaProducto">Listar productos</button>
          </div>
      </div>
  </div>

<div class="modal fade" id="agrearPresentacion" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	Tabla de contenidos
			      <div class="modal-dialog">
			        <div class="modal-content">
			          <div class="modal-header">
			            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			            <h4>Agregar Presentacion</h4>
			          </div>
			          <div class="modal-body">
			          Producto:</br>
					    <input type="text" name="idProducto" id="productoId" required class="form-control" value="{{producto.nombre}}">
			            Presentación</br>
			            <!-- <form action="/Presentacion/registrar/" method="post" enctype="multipart/form-data">
						{% csrf_token %} -->
					    <select class="form-control" id="cmbPresentacion" required>
					    	<!--<option value=""> </option>-->
	                        {% for presentacion in presentaciones %}
	                            <option value="{{presentacion.id}}">
	                            {{presentacion.nombre}}
	                            </option>
	                        {% endfor %}
	                        </select>
	                    Cantidad de presentacion en unidad principal:</br>
					    <input type="number" name="cantPresentacion" id="cantPresentacion" required class="form-control">
					    {% for precio in precios%}
						Precio - {{ precio.nombre }}</br>
					    <input type="number" name="{{precio.id}}Precio" id="{{precio.id}}Precio" required class="form-control">
					    {% endfor %}</br>
              <br>
              <div class="col-lg-12" style="margin-top:2px;">
                <div class="col-xs-6 col-sm-6 col-md-6">
                  <br>
                  <button id="bt_add" class="btn btn-success">Agregar</button>
                  <button id="bt_del" class="btn btn-warning">Eliminar</button>
                  <button id="bt_delall" class="btn btn-danger">Eliminar todo</button>
                  <br>
                  <br>
                </div>
              </div>

              <div class="col-lg-12" style="margin-top:2px;">
                <div class="col-xs-12 col-sm-12 col-md-12">

                  <div class="row">
                      <div class="form-group">
                          <label ><center>Concepto Operación</center></label>
                          <table id="tabla" name="tablacontenido" class="table table-bordered">
                          <thead>
                              <tr>
                                <td>Nº</td>
                                <td>Presentación</td>
                                <td>Cantidad pre. prin.</td>
                                <td>Precio 1</td>
                                <td>Precio 2</td>
                                <td>Precio 3</td>
                              </tr>
                          </thead>


                          </table>

                          <br>
                      </div>
                          TOTAL: S/. <label for="id_Total" id="id_Total" name="id_Total"></label>
                          <br>
                          <br>

                      <button id="bt_GenerarVenta" class="btn btn-success">Realizar Pedido</button>
                    <!--</form>-->
                  </div>
                </div>
              </div>

                  <div class="row">
                      <div class="form-group">
                          <div class="col-sm-8 col-md-8 col-lg-6">
                              <div id="tabs" style="display:none;">
                                  <table id="listaProducto"></table>
                                  <div id="pagerlistaProducto"  style="text-align: center;"></div>
                              </div>
                          </div>

                          <div class="col-sm-2 col-md-2 col-lg-4">

                          </div>
                      </div>
                  </div>
			          </div>
                <div class="modal-footer">
                  <button id="registrarPresentacion" type="button" class="btn btn-primary" onclick="">Registrar</button>
                  <button type="button" class="btn btn-secondary" id="productoListar" data-dismiss="modal">Listar Productos</button>
                  <script type="text/javascript">
                    $(document).ready(function(){
                      $('#registrarPresentacion').click(function(){
                        presentaciones = []
                        precios = []
                        var producto = document.getElementById("productoId").value;
                        var presentacion = document.getElementById("cmbPresentacion").value;
                        var valor = document.getElementById("cantPresentacion").value;
                        var precio1 = document.getElementById("1Precio").value;
                        var precio2 = document.getElementById("2Precio").value;
                        var precio3 = document.getElementById("3Precio").value;
                        presentaciones.push([producto,presentacion,valor]);
                        precios.push([precio1,precio2,precio3]);
                        var datos = {
                              presentaciones: presentaciones,
                              precios: precios
                          };

                          var sendData = JSON.stringify(datos);
                          $.ajax({
                              type: "POST",
                              dataType: "json",
                              url: "/Presentacion/nuevo/",
                              data: sendData,
                              contentType: "application/json; charset=utf-8",
                              async: false,
                              cache: false,
                              CrossDomain: true,

                              success: function (result) {
                              //     var id_venta = result["id_venta"];
                                  var sel = document.getElementById("cmbPresentacion");
                                  sel.remove(sel.SelectedIndex);
                                  $(' #cantPresentacion ').val("");
                                  $(' #1Precio ').val("");
                                  $(' #2Precio ').val("");
                                  $(' #3Precio ').val("");
                                  alert('Presentacion de producto Registrado');
                                   //location.reload(true);
                                   //document.location.href='/Pedido/listar/';
                              }
                          });

                      });
                      $('#productoListar').click(function(){
                        document.location.href='/Producto/listar/';
                      });
                      $('#listaProducto').click(function(){
                        document.location.href='/Producto/listar/';
                      });
                    });
                  </script>
                </div>
			</div>
	    </div>
    </div>
{% endblock %}
